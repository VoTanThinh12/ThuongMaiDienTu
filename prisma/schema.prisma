generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(100)
  email      String   @unique(map: "email") @db.VarChar(100)
  password   String   @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamp(0)
}

model chi_tiet_hoa_don_ban {
  id          Int          @id @default(autoincrement())
  id_hoa_don  Int?
  id_san_pham Int?
  so_luong    Int?
  don_gia     Decimal?     @db.Decimal(10, 2)
  hoa_don_ban hoa_don_ban? @relation(fields: [id_hoa_don], references: [id], onDelete: Cascade, map: "chi_tiet_hoa_don_ban_ibfk_1")
  san_pham    san_pham?    @relation(fields: [id_san_pham], references: [id], onDelete: Cascade, map: "chi_tiet_hoa_don_ban_ibfk_2")

  @@index([id_hoa_don], map: "id_hoa_don")
  @@index([id_san_pham], map: "id_san_pham")
}

model chi_tiet_phieu_nhap {
  id            Int         @id @default(autoincrement())
  id_phieu_nhap Int?
  id_san_pham   Int?
  so_luong_nhap Int?
  gia_nhap      Decimal?    @db.Decimal(10, 2)
  phieu_nhap    phieu_nhap? @relation(fields: [id_phieu_nhap], references: [id], onDelete: Cascade, map: "chi_tiet_phieu_nhap_ibfk_1")
  san_pham      san_pham?   @relation(fields: [id_san_pham], references: [id], onDelete: Cascade, map: "chi_tiet_phieu_nhap_ibfk_2")

  @@index([id_phieu_nhap], map: "id_phieu_nhap")
  @@index([id_san_pham], map: "id_san_pham")
}

model hoa_don_ban {
  id                   Int                    @id @default(autoincrement())
  id_nhan_vien         Int?
  ngay_ban             DateTime?              @default(now()) @db.DateTime(0)
  tong_tien            Decimal?               @db.Decimal(10, 2)
  chi_tiet_hoa_don_ban chi_tiet_hoa_don_ban[]
  nhan_vien            nhan_vien?             @relation(fields: [id_nhan_vien], references: [id], map: "hoa_don_ban_ibfk_1")

  @@index([id_nhan_vien], map: "id_nhan_vien")
}

model nha_cung_cap {
  id               Int          @id @default(autoincrement())
  ten_nha_cung_cap String?      @db.VarChar(100)
  so_dien_thoai    String?      @db.VarChar(15)
  dia_chi          String?      @db.Text
  phieu_nhap       phieu_nhap[]
}

model nhan_vien {
  id            Int                  @id @default(autoincrement())
  ho_ten        String               @db.VarChar(100)
  tai_khoan     String               @unique @db.VarChar(50)
  mat_khau      String               @db.VarChar(100)
  vai_tro       nhan_vien_vai_tro    @default(quan_ly)
  trang_thai    nhan_vien_trang_thai @default(Dang_lam)
  so_dien_thoai String?              @db.VarChar(15)
  dia_chi       String?              @db.Text
  email         String?              @unique
  ngay_sinh     DateTime?            @db.Date
  ngay_vao_lam  DateTime?            @db.Date
  hoa_don_ban   hoa_don_ban[]
  phieu_nhap    phieu_nhap[]

  @@index([tai_khoan], map: "tai_khoan")
  @@map("nhan_vien")
}

model phieu_nhap {
  id                  Int                   @id @default(autoincrement())
  id_nha_cung_cap     Int?
  ngay_nhap           DateTime?             @default(now()) @db.DateTime(0)
  id_nhan_vien        Int?
  chi_tiet_phieu_nhap chi_tiet_phieu_nhap[]
  nha_cung_cap        nha_cung_cap?         @relation(fields: [id_nha_cung_cap], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "phieu_nhap_ibfk_1")
  nhan_vien           nhan_vien?            @relation(fields: [id_nhan_vien], references: [id], map: "phieu_nhap_ibfk_2")

  @@index([id_nha_cung_cap], map: "id_nha_cung_cap")
  @@index([id_nhan_vien], map: "id_nhan_vien")
}

model san_pham {
  id                   Int                    @id @default(autoincrement())
  ten_san_pham         String?                @db.VarChar(100)
  ma_san_pham          String?                @unique(map: "ma_san_pham") @db.VarChar(50)
  don_vi_tinh          String?                @db.VarChar(50)
  gia_ban              Decimal?               @db.Decimal(10, 2)
  so_luong             Int?                   @default(0)
  ngay_tao             DateTime?              @default(now()) @db.DateTime(0)
  hinh_anh             String?                @db.VarChar(255)
  danh_muc             String?                @db.VarChar(50)
  chi_tiet_don_hang    chi_tiet_don_hang[]
  chi_tiet_hoa_don_ban chi_tiet_hoa_don_ban[]
  chi_tiet_phieu_nhap  chi_tiet_phieu_nhap[]
  gio_hang             gio_hang[]
}

model khach_hang {
  id            Int             @id @default(autoincrement())
  email         String          @unique @db.VarChar(100)
  mat_khau      String          @db.VarChar(255)
  ho_ten        String          @db.VarChar(100)
  so_dien_thoai String?         @db.VarChar(15)
  ngay_tao      DateTime        @default(now()) @db.DateTime(0)
  trang_thai    Boolean         @default(true)
  dia_chi       dia_chi_khach[]
  don_hang      don_hang[]
  gio_hang      gio_hang[]
  su_dung_voucher su_dung_voucher[]
}

model dia_chi_khach {
  id                Int        @id @default(autoincrement())
  id_khach_hang     Int
  ho_ten_nguoi_nhan String     @db.VarChar(100)
  so_dien_thoai     String     @db.VarChar(15)
  dia_chi_chi_tiet  String     @db.Text
  phuong_xa         String?    @db.VarChar(100)
  quan_huyen        String?    @db.VarChar(100)
  tinh_thanh        String?    @db.VarChar(100)
  mac_dinh          Boolean    @default(false)
  khach_hang        khach_hang @relation(fields: [id_khach_hang], references: [id], onDelete: Cascade)

  @@index([id_khach_hang])
}

model gio_hang {
  id            Int        @id @default(autoincrement())
  id_khach_hang Int
  id_san_pham   Int
  so_luong      Int
  ngay_them     DateTime   @default(now()) @db.DateTime(0)
  khach_hang    khach_hang @relation(fields: [id_khach_hang], references: [id], onDelete: Cascade)
  san_pham      san_pham   @relation(fields: [id_san_pham], references: [id], onDelete: Cascade)

  @@unique([id_khach_hang, id_san_pham])
  @@index([id_khach_hang])
  @@index([id_san_pham])
}

model don_hang {
  id                     Int                 @id @default(autoincrement())
  ma_don_hang            String              @unique @db.VarChar(50)
  id_khach_hang          Int
  tong_tien              Decimal             @db.Decimal(10, 2)
  trang_thai             don_hang_trang_thai @default(cho_xac_nhan)
  phuong_thuc_thanh_toan String              @db.VarChar(50)
  trang_thai_thanh_toan  Boolean             @default(false)
  dia_chi_giao_hang      String              @db.Text
  ho_ten_nguoi_nhan      String              @db.VarChar(100)
  so_dien_thoai          String              @db.VarChar(15)
  ghi_chu                String?             @db.Text
  ngay_tao               DateTime            @default(now()) @db.DateTime(0)
  ngay_cap_nhat          DateTime            @updatedAt @db.DateTime(0)
  chi_tiet_don_hang      chi_tiet_don_hang[]
  khach_hang             khach_hang          @relation(fields: [id_khach_hang], references: [id])
  su_dung_voucher        su_dung_voucher[]
  giao_dich_ngan_hang    giao_dich_ngan_hang[]

  @@index([id_khach_hang])
  @@index([ma_don_hang])
}

model chi_tiet_don_hang {
  id           Int      @id @default(autoincrement())
  id_don_hang  Int
  id_san_pham  Int
  ten_san_pham String   @db.VarChar(100)
  so_luong     Int
  don_gia      Decimal  @db.Decimal(10, 2)
  don_hang     don_hang @relation(fields: [id_don_hang], references: [id], onDelete: Cascade)
  san_pham     san_pham @relation(fields: [id_san_pham], references: [id])

  @@index([id_don_hang])
  @@index([id_san_pham])
}

enum nhan_vien_vai_tro {
  quan_ly
  thu_ngan
  nhan_vien_kho
}

enum nhan_vien_trang_thai {
  Dang_lam @map("Đang làm")
  Da_nghi  @map("Đã nghỉ")
}

enum don_hang_trang_thai {
  cho_xac_nhan
  da_xac_nhan
  dang_giao
  da_giao
  da_huy
}

// Voucher System Models
model voucher {
  id                Int                @id @default(autoincrement())
  ma_voucher        String             @unique @db.VarChar(50)
  ten_voucher       String             @db.VarChar(100)
  mo_ta             String?            @db.Text
  loai_giam_gia     voucher_loai        @default(phan_tram)
  gia_tri_giam      Decimal            @db.Decimal(10, 2)
  gia_tri_toi_thieu Decimal?           @db.Decimal(10, 2)
  gia_tri_toi_da    Decimal?           @db.Decimal(10, 2)
  so_luong          Int                @default(1)
  so_luong_da_dung  Int                @default(0)
  ngay_bat_dau      DateTime           @db.DateTime(0)
  ngay_ket_thuc     DateTime           @db.DateTime(0)
  trang_thai        voucher_trang_thai @default(hoat_dong)
  ngay_tao          DateTime           @default(now()) @db.DateTime(0)
  ngay_cap_nhat     DateTime           @updatedAt @db.DateTime(0)
  su_dung_voucher   su_dung_voucher[]
  
  @@index([ma_voucher])
  @@index([trang_thai])
  @@index([ngay_bat_dau])
  @@index([ngay_ket_thuc])
}

model su_dung_voucher {
  id           Int      @id @default(autoincrement())
  id_voucher   Int
  id_don_hang  Int
  id_khach_hang Int
  so_tien_giam Decimal  @db.Decimal(10, 2)
  ngay_su_dung DateTime @default(now()) @db.DateTime(0)
  voucher      voucher  @relation(fields: [id_voucher], references: [id])
  don_hang     don_hang @relation(fields: [id_don_hang], references: [id])
  khach_hang   khach_hang @relation(fields: [id_khach_hang], references: [id])
  
  @@unique([id_don_hang])
  @@index([id_voucher])
  @@index([id_don_hang])
  @@index([id_khach_hang])
}

enum voucher_loai {
  phan_tram
  tien_mat
}

enum voucher_trang_thai {
  hoat_dong
  tam_dung
  het_han
  het_luong
}

// Bank Transaction Models
model giao_dich_ngan_hang {
  id                Int                        @id @default(autoincrement())
  ma_giao_dich      String                     @unique @db.VarChar(100)
  ma_don_hang       String                     @db.VarChar(50)
  so_tien           Decimal                    @db.Decimal(10, 2)
  ma_xac_minh       String                     @db.VarChar(20)
  trang_thai        giao_dich_ngan_hang_trang_thai @default(cho_xac_nhan)
  thoi_gian_tao     DateTime                   @default(now()) @db.DateTime(0)
  thoi_gian_het_han DateTime                   @db.DateTime(0)
  thoi_gian_xac_nhan DateTime?                 @db.DateTime(0)
  nguoi_xac_nhan    String?                    @db.VarChar(100)
  ly_do_tu_choi     String?                    @db.Text
  noi_dung          String?                    @db.Text
  don_hang          don_hang?                  @relation(fields: [ma_don_hang], references: [ma_don_hang])
  
  @@index([ma_giao_dich])
  @@index([ma_don_hang])
  @@index([trang_thai])
  @@index([thoi_gian_tao])
}

enum giao_dich_ngan_hang_trang_thai {
  cho_xac_nhan
  da_xac_nhan
  bi_tu_choi
  het_han
}
